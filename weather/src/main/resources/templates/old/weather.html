<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>天穹 - 天气查询</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" href="/css/colors.css">
    <style>
        body {
            /* 粉蓝斜角渐变背景 */
            /* 固定背景，使其全屏覆盖不重复 */
            background: linear-gradient(135deg, var(--main-blue2), var(--main-pink1)) fixed;
            color: var(--text-main); /* 主文字颜色 */
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            padding: 2rem; /* 在四周添加间距 */
        }
        .weather-container {
            margin: 0 auto; /* 水平居中 */
            background-color: var(--panel-bg);
            border-radius: 20px;
            padding: 20px;
            box-shadow: var(--form-shadow);
            -webkit-backdrop-filter: blur(10px); /* Safari 兼容性 */
            backdrop-filter: blur(10px);
        }
        .panel {
            background-color: var(--panel-bg);
            border-radius: 15px;
            padding: 30px;
            height: 100%;
            min-height: 675px; /* 为面板设置最小高度，确保布局稳定 */
        }
        h1 {
            color: transparent; /* 将文字颜色设为透明 */
            text-align: center;
            margin-bottom: 30px;
            font-weight: bold;
            font-size: 5rem; /* 适当增大字体大小以获得更好的效果 */
            background-image: url('/images/gif/title.gif'); /* 使用GIF作为背景 */
            background-size: cover;
            -webkit-background-clip: text; /* 兼容Safari */
            background-clip: text;
        }
        .form-label {
            color: var(--main-pink3);
            font-weight: 500;
        }
        .form-select {
            border-color: var(--main-blue2);
            background-color: var(--form-bg);
            color: var(--text-main);
        }
        .form-select:focus,.form-select:hover {
            border-color: var(--main-blue2);
            box-shadow: 0 0 0 0.25rem var(--main-blue2);
        }
        .weather-results h5 {
            color: var(--main-pink3);
            font-weight: bold;
            border-bottom: 2px solid var(--accent-pink);
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .weather-item {
            background-color: var(--item-bg);
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 8px;
            border-left: 5px solid var(--accent-pink); /* 强调色 */
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.95rem;
        }
        .weather-item strong {
            color: var(--text-secondary);
            margin-right: 10px;
        }

        .accordion-body {
            background-color: var(--form-bg);
        }
        .accordion-button {
            color: var(--text-secondary);
        }
        .accordion-button:not(.collapsed), .accordion-button:hover {
            color: var(--form-shadow);
            background-color: var(--item-bg);
            box-shadow: 0 0 0 0.25rem var(--main-blue2);
            font-weight: bold;
        }

        /* 自定义按钮颜色 */
        #queryBtn {
            background-color: var(--accent-green);
            color: var(--text-main);
            border: none;
        }
        #queryBtn:hover {
            background-color: var(--main-blue3);
        }
        #resetBtn {
            background-color: var(--accent-yellow);
            color: var(--text-main);
            border: none;
        }
        #resetBtn:hover {
            background-color: var(--main-pink3);
        }
        
        /* 7天日历按钮样式 */
        .week-btn {
            background-color: var(--item-bg);
            color: var(--main-blue3);
            font-size: 0.85rem;
            padding: 0.25rem 0.7rem;
            border-radius: 12px;
            border-color: var(--main-blue3);
            margin-bottom: 4px;
            min-width: 90px;
        }
        .week-btn.active, .week-btn:active, .week-btn:focus, .week-btn:hover {
            background-color: var(--main-blue3);
            color: var(--item-bg);
            border-color: var(--main-blue3);
            font-weight: bold;
        }
        /* 仅7天天气详情内容靠右 */
        .seven-days-detail .weather-item span {
            margin-left: auto;
            text-align: right;
            display: block;
        }
        /* 固定生活建议内容宽度，防止压缩标题 */
        .weather-item.suggestion-item span {
            max-width: 930px;
            text-align: left;
            display: inline-block;
            white-space: normal;
            word-break: break-all;
        }
        .weather-group-row {
            display: flex;
            gap: 1.05rem;
            margin-bottom: 0.5rem;
        }
        .weather-item.grouped {
            flex: 1;
            margin-bottom: 0;
            font-size: 1rem;
            min-width: 0;
        }
        .poem-quote {
            color: var(--text-secondary);
            font-size: 1.05rem;
            font-style: italic;
            letter-spacing: 1px;
            text-align: center;
            margin-top: 1rem;
            display: block;
        }
    </style>
    <script>
        $(document).ready(function(){
            // 查询按钮点击事件
            $('#queryBtn').click(function(){
                const selectedCity = $('#cityId').val();
                const selectedType = $('#type').val();
                if(selectedCity) {
                    window.location.href = '/getWeatherThy?city=' + selectedCity + '&type=' + selectedType;
                } else {
                    alert('请选择一个城市');
                }
            });
            // 重置按钮点击事件
            $('#resetBtn').click(function(){
                $('#cityId').val('');
                $('#type').val('1');
                window.location.href = '/getWeatherThy';
            });
        });
        // 7天日历切换逻辑
        $(document).on('click', '.week-btn', function(){
            var idx = $(this).data('idx');
            $('.week-btn').removeClass('active');
            $(this).addClass('active');
            $('[id^=day-detail-]').hide();
            $('#day-detail-' + idx).show();
        });
    </script>
</head>
<body>

<div class="container-fluid weather-container">
    <div class="row g-4">
        <!-- 左侧选择栏 -->
        <div class="col-lg-3">
            <div class="panel">
                <h1>天穹</h1>
                <div class="mb-3">
                    <label for="cityId" class="form-label">城市：</label>
                    <select class="form-select" name="cityId" id="cityId">
                        <option value="">请选择一个城市</option>
                        <th:block th:each="city : ${cityList}">
                            <option th:value="${city.cityId}" th:text="${city.city}" th:selected="${city.cityId} == ${selectedCityId}"></option>
                        </th:block>
                    </select>
                </div>
                <div class="mb-3">
                    <label for="type" class="form-label">请选择天数：</label>
                    <select class="form-select" name="type" id="type">
                        <option value="1" th:selected="${selectedType == '1'}">1天</option>
                        <option value="7" th:selected="${selectedType == '7'}">7天</option>
                    </select>
                </div>
                <div class="mb-3 d-flex gap-6 justify-content-center" style="margin-top: 30px;">
                    <button class="btn btn-primary" id="queryBtn" type="button">查询</button>
                    <button class="btn btn-secondary ms-5" id="resetBtn" type="button">重置</button>
                </div>
            </div>
        </div>

        <!-- 右侧结果展示 -->
        <div class="col-lg-9">
            <div class="panel">
                <!-- 天气数据结果区域，仅当weatherdata可用时显示 -->
                <div th:if="${weatherdata}" class="weather-results">
                    <h5>查询结果</h5>
                    <!-- 7天日历切换，仅type=7且有list时显示 -->
                    <div th:if="${selectedType == '7' and weatherdata.result.list != null}" class="mb-4">
                        <div class="d-flex justify-content-center gap-3 flex-wrap">
                            <button type="button" class="btn btn-outline-primary week-btn" th:each="day,idx : ${weatherdata.result.list}"
                                    th:text="${day.date + ' ' + day.week}"
                                    th:data-idx="${idx.index}"
                                    th:classappend="${idx.index == 0} ? 'active' : ''">
                            </button>
                        </div>
                    </div>
                    <!-- 7天详情展示 -->
                    <div th:if="${selectedType == '7' and weatherdata.result.list != null}">
                        <div th:each="day,idx : ${weatherdata.result.list}" th:id="'day-detail-' + ${idx.index}" th:style="${idx.index == 0} ? '' : 'display:none;'" class="seven-days-detail">
                            <div class="accordion mt-3" th:id="'accordion7d' + ${idx.index}">
                                <div class="accordion-item">
                                    <h2 class="accordion-header">
                                        <button class="accordion-button" type="button" data-bs-toggle="collapse" th:data-bs-target="'#collapse7d' + ${idx.index}" aria-expanded="true" th:aria-controls="'collapse7d' + ${idx.index}">
                                            <span th:text="${day.date + ' ' + day.week}"></span>
                                        </button>
                                    </h2>
                                    <div th:id="'collapse7d' + ${idx.index}" class="accordion-collapse collapse show" th:classappend="${idx.index == 0} ? 'show' : ''" th:data-bs-parent="'#accordion7d' + ${idx.index}">
                                        <div class="accordion-body">
                                            <div class="weather-item">
                                                <strong>天气:</strong>
                                                <span th:text="${day.weather}"></span>
                                                <img th:if="${day.weatherimg != null}" th:src="'/images/png/' + ${day.weatherimg}" alt="天气图标" style="height: 24px; vertical-align: middle; margin-left: 10px;"/>
                                            </div>
                                            <div class="weather-group-row">
                                                <div class="weather-item grouped"><strong>实时温度:</strong> <span th:text="${day.real}"></span></div>
                                                <div class="weather-item grouped"><strong>最低温度:</strong> <span th:text="${day.lowest}"></span></div>
                                                <div class="weather-item grouped"><strong>最高温度:</strong> <span th:text="${day.highest}"></span></div>
                                            </div>
                                            <div class="weather-group-row">
                                                <div class="weather-item grouped"><strong>风向:</strong> <span th:text="${day.wind}"></span></div>
                                                <div class="weather-item grouped"><strong>风速:</strong> <span th:text="${day.windspeed}"></span></div>
                                                <div class="weather-item grouped"><strong>风力:</strong> <span th:text="${day.windsc}"></span></div>
                                            </div>
                                            <div class="weather-group-row">
                                                <div class="weather-item grouped"><strong>湿度:</strong> <span th:text="${day.humidity}"></span></div>
                                                <div class="weather-item grouped"><strong>降水量:</strong> <span th:text="${day.pcpn}"></span></div>
                                                <div class="weather-item grouped"><strong>紫外线指数:</strong> <span th:text="${day.uv_index}"></span></div>
                                                <div class="weather-item grouped"><strong>能见度:</strong> <span th:text="${day.vis}"></span></div>
                                            </div>
                                            <div class="weather-group-row">
                                                <div class="weather-item grouped"><strong>日出时间:</strong> <span th:text="${day.sunrise}"></span></div>
                                                <div class="weather-item grouped"><strong>日落时间:</strong> <span th:text="${day.sunset}"></span></div>
                                                <div class="weather-item grouped"><strong>月升时间:</strong> <span th:text="${day.moonrise}"></span></div>
                                                <div class="weather-item grouped"><strong>月落时间:</strong> <span th:text="${day.moondown}"></span></div>
                                            </div>
                                            <div class="weather-item suggestion-item"><strong>生活建议:</strong> <span th:text="${day.tips}"></span></div>
                                            <div class="weather-item" th:if="${weatherdata.result.alarmlist != null && #lists.size(weatherdata.result.alarmlist) > 0}">
                                                <strong>预警信息:</strong>
                                                <div>
                                                    <div th:each="alarm : ${weatherdata.result.alarmlist}" style="margin-bottom: 8px;">
                                                        <span th:text="'[' + alarm.level + ']' + alarm.type + ' - ' + alarm.content + '（' + alarm.time + '）'"></span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="mt-3 text-center poem-quote">
                                                &ldquo;<span th:text="${day.poem}"></span>&rdquo;
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 原有1天展示逻辑 -->
                    <div th:if="${selectedType == '1'}" class="accordion" id="weatherAccordion">
                        <!-- 基本信息 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                    基本信息
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne">
                                <div class="accordion-body">
                                    <div th:if="${weatherdata.result}">
                                        <div class="weather-group-row">
                                            <div class="weather-item grouped"><strong>日期:</strong> <span th:text="${weatherdata.result.date + ' ' + weatherdata.result.week}"></span></div>
                                            <div class="weather-item grouped"><strong>地区:</strong> <span th:text="${weatherdata.result.province + ' ' + weatherdata.result.area}"></span></div>
                                            <div class="weather-item grouped">
                                                <strong>天气:</strong>
                                                <span th:text="${weatherdata.result.weather}"></span>
                                                <img th:if="${weatherIconPath != null}" th:src="${weatherIconPath}" alt="天气图标" style="height: 24px; vertical-align: middle; margin-left: 10px;"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- 详细信息 -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingTwo">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                    详细信息
                                </button>
                            </h2>
                            <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo">
                                <div class="accordion-body">
                                    <div th:if="${weatherdata.result}">
                                        <div class="weather-group-row">
                                            <div class="weather-item grouped"><strong>实时温度:</strong> <span th:text="${weatherdata.result.real}"></span></div>
                                            <div class="weather-item grouped"><strong>最低温度:</strong> <span th:text="${weatherdata.result.lowest}"></span></div>
                                            <div class="weather-item grouped"><strong>最高温度:</strong> <span th:text="${weatherdata.result.highest}"></span></div>
                                        </div>
                                        <div class="weather-group-row">
                                            <div class="weather-item grouped"><strong>风向:</strong> <span th:text="${weatherdata.result.wind}"></span></div>
                                            <div class="weather-item grouped"><strong>风速:</strong> <span th:text="${weatherdata.result.windspeed}"></span></div>
                                            <div class="weather-item grouped"><strong>风力:</strong> <span th:text="${weatherdata.result.windsc}"></span></div>
                                        </div>
                                        <div class="weather-group-row">
                                            <div class="weather-item grouped"><strong>湿度:</strong> <span th:text="${weatherdata.result.humidity}"></span></div>
                                            <div class="weather-item grouped"><strong>降水量:</strong> <span th:text="${weatherdata.result.pcpn}"></span></div>
                                            <div class="weather-item grouped"><strong>紫外线指数:</strong> <span th:text="${weatherdata.result.uv_index}"></span></div>
                                            <div class="weather-item grouped"><strong>能见度:</strong> <span th:text="${weatherdata.result.vis}"></span></div>
                                        </div>
                                        <div class="weather-group-row">
                                            <div class="weather-item grouped"><strong>日出时间:</strong> <span th:text="${weatherdata.result.sunrise}"></span></div>
                                            <div class="weather-item grouped"><strong>日落时间:</strong> <span th:text="${weatherdata.result.sunset}"></span></div>
                                            <div class="weather-item grouped"><strong>月升时间:</strong> <span th:text="${weatherdata.result.moonrise}"></span></div>
                                            <div class="weather-item grouped"><strong>月落时间:</strong> <span th:text="${weatherdata.result.moondown}"></span></div>
                                        </div>
                                        <div class="weather-item suggestion-item"><strong>生活建议:</strong> <span th:text="${weatherdata.result.tips}"></span></div>
                                        <div class="weather-item" th:if="${weatherdata.result.alarmlist != null && #lists.size(weatherdata.result.alarmlist) > 0}">
                                            <strong>预警信息:</strong>
                                            <div>
                                                <div th:each="alarm : ${weatherdata.result.alarmlist}" style="margin-bottom: 8px;">
                                                    <span th:text="'[' + alarm.level + ']' + alarm.type + ' - ' + alarm.content + '（' + alarm.time + '）'"></span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mt-3 text-center poem-quote">
                                            &ldquo;<span th:text="${weatherdata.result.poem}"></span>&rdquo;
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>